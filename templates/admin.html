<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Vdio | Admin Panel</title>
  <link rel="stylesheet" href="../static/css/admin.css">
  <link rel="icon" href="../static/media/v.png" type="image/png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

  <nav>
    <h2>Account</h2>
    <a href="{{ url_for('login_page') }}"><i class="fa-solid fa-user"></i><span class="text">Login</span></a>
    <a href="{{ url_for('dashboard') }}"><i class="fa-solid fa-chart-line"></i><span class="text">Dashboard</span></a>
    <a href="{{ url_for('admin_panel') }}"><i class="fa-solid fa-lock"></i><span class="text">Admin Panel</span></a>
  </nav>

<div class="content">
  <header>
    <h1><img src="../static/media/v.png" alt="V Logo">dio</h1>
    <p>Admin Panel</p>
  </header>

  <section class="summary">
    <h2>Site Overview</h2>
    <div class="stats-grid">
      <div class="stat-card"><h3>Users</h3><p>{{ user_count }}</p></div>
      <div class="stat-card"><h3>Tool Uses</h3><p>{{ tool_uses }}</p></div>
      <div class="stat-card"><h3>Challenges</h3><p>{{ challenge_count }} Submitted</p></div>
      <div class="stat-card"><h3>Visits</h3><p>{{ visits }}</p></div>
      <div class="stat-card"><h3>Admins</h3><p>{{ admin_count }}</p></div>
      <div class="stat-card"><h3>Creators</h3><p>{{ creator_count }}</p></div>
    </div>
  </section>

  <section class="user-management">
    <h2>Manage Users</h2>
    <table>
      <thead>
        <tr><th>Name</th><th>Email</th><th>Role</th><th>Actions</th></tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role or 'user' }}</td>
          <td>
            <button>Edit</button>
            <button onclick="deleteUser('{{ user.email }}')">Delete</button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="challenges">
    <h2>Challenge Submissions</h2>
    <ul>
      {% for challenge in challenges %}
        <li><strong>{{ challenge.title }}</strong> by {{ challenge.user }} â€”
          <button onclick="updateChallenge('{{ challenge.title }}', 'approve')">Approve</button>
          <button onclick="updateChallenge('{{ challenge.title }}', 'reject')">Reject</button>
          <span style="margin-left:10px;">Status: {{ challenge.status or 'pending' }}</span>
        </li>
      {% endfor %}
    </ul>
  </section>
</div>

<script>
  async function deleteUser(email) {
    if (confirm("Are you sure you want to delete " + email + "?")) {
      const res = await fetch(`/admin/delete_user?email=${email}`, { method: "DELETE" });
      const msg = await res.text();
      alert(msg);
      location.reload();
    }
  }

  async function updateChallenge(title, action) {
    const url = action === "approve" ? "/admin/approve_challenge" : "/admin/reject_challenge";
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ title })
    });

    const msg = await res.text();
    alert(msg);
    location.reload();
  }
</script>

</body>
</html>
